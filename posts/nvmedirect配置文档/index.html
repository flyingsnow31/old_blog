<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Nvmedirect配置文档 | Flying Snow Blog</title><meta name=keywords content="nvmedirect"><meta name=description content="nvmedirect配置文档 环境需求 使用的环境为Ubuntu 14.04/16.04
需要注意的是，直接安装好的Ubuntu 14.04/Ubuntu 16.04的linux内核版本为4.4。
注意：安装Ubuntu虚拟机时，需要将硬盘设置为NVMe而非SCSI
但是nvmedirect需要在4.11的内核版本上进行，所以需要升级一下内核版本。
方法如下
升级 Ubuntu Linux 内核的几种不同方法 | Linux 中国 (qq.com)
通过多方比较，选用第一种方法，即使用dpkg手动安装内核。
升级内核 预编译好的内核文件网址如下，从中找到需要的版本，即4.11
Index of /~kernel-ppa/mainline (ubuntu.com)
根据自己的硬件环境，找到对应的内核版本。
将linux-headers-...-all.deb, linux-headers-...-generic-....deb, linux-image-....deb共三个文件下载，如果存在linux-module-....deb也需要下载。
将其放在同一个目录下。
执行如下命令，通过dpkg进行安装
$ sudo dpkg --install *.deb 然后系统自动执行安装过程，等待一小会儿后，安装完成，重启系统
$ sudo reboot 重新进入系统，查看内核版本
$ uname -r 4.11.0-041100-generic 内核升级完成
其他需求 需要安装gcc, make等编译相关工具，gcc版本需要在5
更新gcc 由于ubuntu14的apt最高版本为gcc4，因此需要增加源安装
添加源
$ sudo add-apt-repository ppa:ubuntu-toolchain-r/test $ sudo apt-get update 安装指定版本gcc
$ sudo apt-get install -y gcc-5 设置gcc各个版本的优先级
$ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 90 切换gcc版本"><meta name=author content="LZY"><link rel=canonical href=https://flyingsnow31.github.io/posts/nvmedirect%E9%85%8D%E7%BD%AE%E6%96%87%E6%A1%A3/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://flyingsnow31.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://flyingsnow31.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://flyingsnow31.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://flyingsnow31.github.io/apple-touch-icon.png><link rel=mask-icon href=https://flyingsnow31.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Nvmedirect配置文档"><meta property="og:description" content="nvmedirect配置文档 环境需求 使用的环境为Ubuntu 14.04/16.04
需要注意的是，直接安装好的Ubuntu 14.04/Ubuntu 16.04的linux内核版本为4.4。
注意：安装Ubuntu虚拟机时，需要将硬盘设置为NVMe而非SCSI
但是nvmedirect需要在4.11的内核版本上进行，所以需要升级一下内核版本。
方法如下
升级 Ubuntu Linux 内核的几种不同方法 | Linux 中国 (qq.com)
通过多方比较，选用第一种方法，即使用dpkg手动安装内核。
升级内核 预编译好的内核文件网址如下，从中找到需要的版本，即4.11
Index of /~kernel-ppa/mainline (ubuntu.com)
根据自己的硬件环境，找到对应的内核版本。
将linux-headers-...-all.deb, linux-headers-...-generic-....deb, linux-image-....deb共三个文件下载，如果存在linux-module-....deb也需要下载。
将其放在同一个目录下。
执行如下命令，通过dpkg进行安装
$ sudo dpkg --install *.deb 然后系统自动执行安装过程，等待一小会儿后，安装完成，重启系统
$ sudo reboot 重新进入系统，查看内核版本
$ uname -r 4.11.0-041100-generic 内核升级完成
其他需求 需要安装gcc, make等编译相关工具，gcc版本需要在5
更新gcc 由于ubuntu14的apt最高版本为gcc4，因此需要增加源安装
添加源
$ sudo add-apt-repository ppa:ubuntu-toolchain-r/test $ sudo apt-get update 安装指定版本gcc
$ sudo apt-get install -y gcc-5 设置gcc各个版本的优先级
$ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 90 切换gcc版本"><meta property="og:type" content="article"><meta property="og:url" content="https://flyingsnow31.github.io/posts/nvmedirect%E9%85%8D%E7%BD%AE%E6%96%87%E6%A1%A3/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-04T20:08:04+08:00"><meta property="article:modified_time" content="2023-02-04T20:08:04+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Nvmedirect配置文档"><meta name=twitter:description content="nvmedirect配置文档 环境需求 使用的环境为Ubuntu 14.04/16.04
需要注意的是，直接安装好的Ubuntu 14.04/Ubuntu 16.04的linux内核版本为4.4。
注意：安装Ubuntu虚拟机时，需要将硬盘设置为NVMe而非SCSI
但是nvmedirect需要在4.11的内核版本上进行，所以需要升级一下内核版本。
方法如下
升级 Ubuntu Linux 内核的几种不同方法 | Linux 中国 (qq.com)
通过多方比较，选用第一种方法，即使用dpkg手动安装内核。
升级内核 预编译好的内核文件网址如下，从中找到需要的版本，即4.11
Index of /~kernel-ppa/mainline (ubuntu.com)
根据自己的硬件环境，找到对应的内核版本。
将linux-headers-...-all.deb, linux-headers-...-generic-....deb, linux-image-....deb共三个文件下载，如果存在linux-module-....deb也需要下载。
将其放在同一个目录下。
执行如下命令，通过dpkg进行安装
$ sudo dpkg --install *.deb 然后系统自动执行安装过程，等待一小会儿后，安装完成，重启系统
$ sudo reboot 重新进入系统，查看内核版本
$ uname -r 4.11.0-041100-generic 内核升级完成
其他需求 需要安装gcc, make等编译相关工具，gcc版本需要在5
更新gcc 由于ubuntu14的apt最高版本为gcc4，因此需要增加源安装
添加源
$ sudo add-apt-repository ppa:ubuntu-toolchain-r/test $ sudo apt-get update 安装指定版本gcc
$ sudo apt-get install -y gcc-5 设置gcc各个版本的优先级
$ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 90 切换gcc版本"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://flyingsnow31.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Nvmedirect配置文档","item":"https://flyingsnow31.github.io/posts/nvmedirect%E9%85%8D%E7%BD%AE%E6%96%87%E6%A1%A3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Nvmedirect配置文档","name":"Nvmedirect配置文档","description":"nvmedirect配置文档 环境需求 使用的环境为Ubuntu 14.04/16.04\n需要注意的是，直接安装好的Ubuntu 14.04/Ubuntu 16.04的linux内核版本为4.4。\n注意：安装Ubuntu虚拟机时，需要将硬盘设置为NVMe而非SCSI\n但是nvmedirect需要在4.11的内核版本上进行，所以需要升级一下内核版本。\n方法如下\n升级 Ubuntu Linux 内核的几种不同方法 | Linux 中国 (qq.com)\n通过多方比较，选用第一种方法，即使用dpkg手动安装内核。\n升级内核 预编译好的内核文件网址如下，从中找到需要的版本，即4.11\nIndex of /~kernel-ppa/mainline (ubuntu.com)\n根据自己的硬件环境，找到对应的内核版本。\n将linux-headers-...-all.deb, linux-headers-...-generic-....deb, linux-image-....deb共三个文件下载，如果存在linux-module-....deb也需要下载。\n将其放在同一个目录下。\n执行如下命令，通过dpkg进行安装\n$ sudo dpkg --install *.deb 然后系统自动执行安装过程，等待一小会儿后，安装完成，重启系统\n$ sudo reboot 重新进入系统，查看内核版本\n$ uname -r 4.11.0-041100-generic 内核升级完成\n其他需求 需要安装gcc, make等编译相关工具，gcc版本需要在5\n更新gcc 由于ubuntu14的apt最高版本为gcc4，因此需要增加源安装\n添加源\n$ sudo add-apt-repository ppa:ubuntu-toolchain-r/test $ sudo apt-get update 安装指定版本gcc\n$ sudo apt-get install -y gcc-5 设置gcc各个版本的优先级\n$ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 90 切换gcc版本","keywords":["nvmedirect"],"articleBody":"nvmedirect配置文档 环境需求 使用的环境为Ubuntu 14.04/16.04\n需要注意的是，直接安装好的Ubuntu 14.04/Ubuntu 16.04的linux内核版本为4.4。\n注意：安装Ubuntu虚拟机时，需要将硬盘设置为NVMe而非SCSI\n但是nvmedirect需要在4.11的内核版本上进行，所以需要升级一下内核版本。\n方法如下\n升级 Ubuntu Linux 内核的几种不同方法 | Linux 中国 (qq.com)\n通过多方比较，选用第一种方法，即使用dpkg手动安装内核。\n升级内核 预编译好的内核文件网址如下，从中找到需要的版本，即4.11\nIndex of /~kernel-ppa/mainline (ubuntu.com)\n根据自己的硬件环境，找到对应的内核版本。\n将linux-headers-...-all.deb, linux-headers-...-generic-....deb, linux-image-....deb共三个文件下载，如果存在linux-module-....deb也需要下载。\n将其放在同一个目录下。\n执行如下命令，通过dpkg进行安装\n$ sudo dpkg --install *.deb 然后系统自动执行安装过程，等待一小会儿后，安装完成，重启系统\n$ sudo reboot 重新进入系统，查看内核版本\n$ uname -r 4.11.0-041100-generic 内核升级完成\n其他需求 需要安装gcc, make等编译相关工具，gcc版本需要在5\n更新gcc 由于ubuntu14的apt最高版本为gcc4，因此需要增加源安装\n添加源\n$ sudo add-apt-repository ppa:ubuntu-toolchain-r/test $ sudo apt-get update 安装指定版本gcc\n$ sudo apt-get install -y gcc-5 设置gcc各个版本的优先级\n$ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 90 切换gcc版本\n$ sudo update-alternatives --config gcc 检查\n$ gcc -v Using built-in specs. COLLECT_GCC=gcc COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/5/lto-wrapper ... Thread model: posix gcc version 5.5.0 20171010 (Ubuntu 5.5.0-12ubuntu1~14.04) 编译安装 下载源码 $ git clone https://github.com/nvmedirect/nvmedirect.git 编译内核与共享库 $ cd nvmedirect $ make 安装 $ sudo make install 安装完成\n加载内核 $ sudo modprobe nvmed 编译安装中可能存在的问题 make失败 内核问题，需要升级到4.11，保证内核版本在4.13以下\nmake install失败 ssl出错，报错如下\nAt main.c:160: - SSL error:02001002:system library:fopen:No such file or directory: bss_file.c:169 - SSL error:2006D080:BIO routines:BIO_new_file:no such file: bss_file.c:172 sign-file: certs/signing_key.pem: No such file or directory 此为内核签名问题，执行如下操作\n(25条消息) ubuntu16.04驱动安装提示sign-file: certs/signing_key.pem: No such file or directory_小码农9527的博客-CSDN博客\n创建 x509.genkey 文件\n[ req ] default_bits = 4096 distinguished_name = req_distinguished_name prompt = no string_mask = utf8only x509_extensions = myexts [ req_distinguished_name ] CN = Modules [ myexts ] basicConstraints=critical,CA:FALSE keyUsage=digitalSignature subjectKeyIdentifier=hash authorityKeyIdentifier=keyid 执行如下命令\n$ openssl req -new -nodes -utf8 -sha512 -days 36500 -batch -x509 -config x509.genkey -outform DER -out signing_key.x509 -keyout signing_key.pem 复制密钥到系统内核源码的证书目录\n$ sudo cp signing_key.pem signing_key.x509 /usr/src/linux-headers-4.11.0-041100-generic/certs/ $ sudo cp signing_key.pem signing_key.pem /usr/src/linux-headers-4.11.0-041100-generic/certs/ 加载内核失败 linux - 我做 modprobe 时找不到模块 - SegmentFault 思否\n报错如下\n$ sudo modprobe nvmed modprobe: FATAL: Module nvmed not found. 首先确认此目录下存在编译好的内核文件\n$ ls /lib/modules/4.11.0-041100-generic/extra nvmed.ko 然后执行如下命令\n$ sudo depmod $ sudo modprobe nvmed 加载成功\n","wordCount":"265","inLanguage":"zh","datePublished":"2023-02-04T20:08:04+08:00","dateModified":"2023-02-04T20:08:04+08:00","author":{"@type":"Person","name":"LZY"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://flyingsnow31.github.io/posts/nvmedirect%E9%85%8D%E7%BD%AE%E6%96%87%E6%A1%A3/"},"publisher":{"@type":"Organization","name":"Flying Snow Blog","logo":{"@type":"ImageObject","url":"https://flyingsnow31.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://flyingsnow31.github.io/ accesskey=h title="Flying Snow Blog (Alt + H)">Flying Snow Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://flyingsnow31.github.io/ title=首页><span>首页</span></a></li><li><a href=https://flyingsnow31.github.io/posts/ title=归档><span>归档</span></a></li><li><a href=https://flyingsnow31.github.io/tags/ title=标签><span>标签</span></a></li><li><a href=https://flyingsnow31.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://flyingsnow31.github.io/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Nvmedirect配置文档</h1><div class=post-meta><span title='2023-02-04 20:08:04 +0800 +0800'>二月 4, 2023</span>&nbsp;·&nbsp;LZY</div></header><div class=post-content><h1 id=nvmedirect配置文档>nvmedirect配置文档<a hidden class=anchor aria-hidden=true href=#nvmedirect配置文档>#</a></h1><h2 id=环境需求>环境需求<a hidden class=anchor aria-hidden=true href=#环境需求>#</a></h2><p>使用的环境为Ubuntu 14.04/16.04</p><p>需要注意的是，直接安装好的Ubuntu 14.04/Ubuntu 16.04的linux内核版本为4.4。</p><p>注意：安装Ubuntu虚拟机时，需要将硬盘设置为NVMe而非SCSI</p><p>但是nvmedirect需要在4.11的内核版本上进行，所以需要升级一下内核版本。</p><p>方法如下</p><p><a href="https://mp.weixin.qq.com/s/6sjNdiLNfP2d9B5GGIUnsA?login=from_csdn">升级 Ubuntu Linux 内核的几种不同方法 | Linux 中国 (qq.com)</a></p><p>通过多方比较，选用第一种方法，即使用dpkg手动安装内核。</p><h3 id=升级内核>升级内核<a hidden class=anchor aria-hidden=true href=#升级内核>#</a></h3><p>预编译好的内核文件网址如下，从中找到需要的版本，即4.11</p><p><a href=https://kernel.ubuntu.com/~kernel-ppa/mainline/>Index of /~kernel-ppa/mainline (ubuntu.com)</a></p><p>根据自己的硬件环境，找到对应的内核版本。</p><p>将<code>linux-headers-...-all.deb</code>, <code>linux-headers-...-generic-....deb</code>, <code>linux-image-....deb</code>共三个文件下载，如果存在<code>linux-module-....deb</code>也需要下载。</p><p>将其放在同一个目录下。</p><p>执行如下命令，通过dpkg进行安装</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo dpkg --install *.deb
</span></span></code></pre></div><p>然后系统自动执行安装过程，等待一小会儿后，安装完成，重启系统</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo reboot
</span></span></code></pre></div><p>重新进入系统，查看内核版本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ uname -r
</span></span><span style=display:flex><span>4.11.0-041100-generic
</span></span></code></pre></div><p>内核升级完成</p><h3 id=其他需求>其他需求<a hidden class=anchor aria-hidden=true href=#其他需求>#</a></h3><p>需要安装gcc, make等编译相关工具，gcc版本需要在5</p><h4 id=更新gcc>更新gcc<a hidden class=anchor aria-hidden=true href=#更新gcc>#</a></h4><p>由于ubuntu14的apt最高版本为gcc4，因此需要增加源安装</p><p>添加源</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo add-apt-repository ppa:ubuntu-toolchain-r/test
</span></span><span style=display:flex><span>$ sudo apt-get update
</span></span></code></pre></div><p>安装指定版本gcc</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo apt-get install -y gcc-5
</span></span></code></pre></div><p>设置gcc各个版本的优先级</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 <span style=color:#ae81ff>90</span>
</span></span></code></pre></div><p>切换gcc版本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo update-alternatives --config gcc
</span></span></code></pre></div><p>检查</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ gcc -v
</span></span><span style=display:flex><span>Using built-in specs.
</span></span><span style=display:flex><span>COLLECT_GCC<span style=color:#f92672>=</span>gcc
</span></span><span style=display:flex><span>COLLECT_LTO_WRAPPER<span style=color:#f92672>=</span>/usr/lib/gcc/x86_64-linux-gnu/5/lto-wrapper
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Thread model: posix
</span></span><span style=display:flex><span>gcc version 5.5.0 <span style=color:#ae81ff>20171010</span> <span style=color:#f92672>(</span>Ubuntu 5.5.0-12ubuntu1~14.04<span style=color:#f92672>)</span>
</span></span></code></pre></div><h2 id=编译安装>编译安装<a hidden class=anchor aria-hidden=true href=#编译安装>#</a></h2><h3 id=下载源码>下载源码<a hidden class=anchor aria-hidden=true href=#下载源码>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ git clone https://github.com/nvmedirect/nvmedirect.git
</span></span></code></pre></div><h3 id=编译内核与共享库>编译内核与共享库<a hidden class=anchor aria-hidden=true href=#编译内核与共享库>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd nvmedirect
</span></span><span style=display:flex><span>$ make
</span></span></code></pre></div><h3 id=安装>安装<a hidden class=anchor aria-hidden=true href=#安装>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo make install
</span></span></code></pre></div><p>安装完成</p><h3 id=加载内核>加载内核<a hidden class=anchor aria-hidden=true href=#加载内核>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo modprobe nvmed
</span></span></code></pre></div><h2 id=编译安装中可能存在的问题>编译安装中可能存在的问题<a hidden class=anchor aria-hidden=true href=#编译安装中可能存在的问题>#</a></h2><h3 id=make失败>make失败<a hidden class=anchor aria-hidden=true href=#make失败>#</a></h3><p>内核问题，需要升级到4.11，保证内核版本在4.13以下</p><h3 id=make-install失败>make install失败<a hidden class=anchor aria-hidden=true href=#make-install失败>#</a></h3><p>ssl出错，报错如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>At main.c:160:
</span></span><span style=display:flex><span>- SSL error:02001002:system library:fopen:No such file or directory: bss_file.c:169
</span></span><span style=display:flex><span>- SSL error:2006D080:BIO routines:BIO_new_file:no such file: bss_file.c:172
</span></span><span style=display:flex><span>sign-file: certs/signing_key.pem: No such file or directory
</span></span></code></pre></div><p>此为内核签名问题，执行如下操作</p><p><a href=https://blog.csdn.net/u011050845/article/details/125699628>(25条消息) ubuntu16.04驱动安装提示sign-file: certs/signing_key.pem: No such file or directory_小码农9527的博客-CSDN博客</a></p><p>创建 <code>x509.genkey</code> 文件</p><pre tabindex=0><code>[ req ]
default_bits = 4096
distinguished_name = req_distinguished_name
prompt = no
string_mask = utf8only
x509_extensions = myexts
 
[ req_distinguished_name ]
CN = Modules
 
[ myexts ]
basicConstraints=critical,CA:FALSE
keyUsage=digitalSignature
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid
</code></pre><p>执行如下命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ openssl req -new -nodes -utf8 -sha512 -days <span style=color:#ae81ff>36500</span> -batch -x509 -config x509.genkey -outform DER -out signing_key.x509 -keyout signing_key.pem
</span></span></code></pre></div><p>复制密钥到系统内核源码的证书目录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo cp signing_key.pem signing_key.x509 /usr/src/linux-headers-4.11.0-041100-generic/certs/
</span></span><span style=display:flex><span>$ sudo cp signing_key.pem signing_key.pem /usr/src/linux-headers-4.11.0-041100-generic/certs/
</span></span></code></pre></div><h3 id=加载内核失败>加载内核失败<a hidden class=anchor aria-hidden=true href=#加载内核失败>#</a></h3><p><a href=https://segmentfault.com/q/1010000042783853>linux - 我做 modprobe 时找不到模块 - SegmentFault 思否</a></p><p>报错如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo modprobe nvmed
</span></span><span style=display:flex><span>modprobe: FATAL: Module nvmed not found.
</span></span></code></pre></div><p>首先确认此目录下存在编译好的内核文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ls /lib/modules/4.11.0-041100-generic/extra
</span></span><span style=display:flex><span>nvmed.ko
</span></span></code></pre></div><p>然后执行如下命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo depmod
</span></span><span style=display:flex><span>$ sudo modprobe nvmed
</span></span></code></pre></div><p>加载成功</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://flyingsnow31.github.io/tags/nvmedirect/>nvmedirect</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://flyingsnow31.github.io/>Flying Snow Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>