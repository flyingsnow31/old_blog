<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Lab1 Utilities | Flying Snow Blog</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="6.S081 Lab1"><meta name=generator content="Hugo 0.107.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Lab1 Utilities"><meta property="og:description" content="6.S081 Lab1"><meta property="og:type" content="article"><meta property="og:url" content="https://flyingsnow31.github.io/posts/oslab/lab1-utilities/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-26T14:30:58+08:00"><meta property="article:modified_time" content="2022-11-26T14:30:58+08:00"><meta itemprop=name content="Lab1 Utilities"><meta itemprop=description content="6.S081 Lab1"><meta itemprop=datePublished content="2022-11-26T14:30:58+08:00"><meta itemprop=dateModified content="2022-11-26T14:30:58+08:00"><meta itemprop=wordCount content="673"><meta itemprop=keywords content="操作系统,6.S081,Utilities,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Lab1 Utilities"><meta name=twitter:description content="6.S081 Lab1"></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Flying Snow Blog</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/ title="首页 页">首页</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="归档 页">归档</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/tags/ title="标签 页">标签</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/categories/ title="分类 页">分类</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="关于 页">关于</a></li></ul><div class=ananke-socials><a href=https://gitee.com/li_zengyi target=_blank class="Gitee ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Gitee link" rel=noopener aria-label="follow on Gitee——Opens in a new window">Gitee
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/flyingsnow31 target=_blank class="GitHub ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">GitHub
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Lab1 Utilities</h1><p class=tracked><strong>LZY</strong></p><time class="f6 mv4 dib tracked" datetime=2022-11-26T14:30:58+08:00>十一月 26, 2022</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><blockquote><p>本实验用于熟悉xv6和系统调用</p></blockquote><h2 id=boot-xv6easy>Boot xv6(easy)</h2><p>启动xv6系统</p><p>首先下载mit提供的针对此次实验设计的xv6版本，而非整体的xv6</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ git clone git://g.csail.mit.edu/xv6-labs-2020
</span></span><span style=display:flex><span>Cloning into <span style=color:#e6db74>&#39;xv6-labs-2020&#39;</span>...
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>$ cd xv6-labs-2020
</span></span><span style=display:flex><span>$ git checkout util
</span></span><span style=display:flex><span>Branch <span style=color:#e6db74>&#39;util&#39;</span> set up to track remote branch <span style=color:#e6db74>&#39;util&#39;</span> from <span style=color:#e6db74>&#39;origin&#39;</span>.
</span></span><span style=display:flex><span>Switched to a new branch <span style=color:#e6db74>&#39;util&#39;</span>
</span></span></code></pre></div><p>在这一步可以将其远程库切换成自己的。</p><p>使用 <code>make qemu</code> 指令编译并通过qemu启动xv6</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make qemu
</span></span><span style=display:flex><span>riscv64-unknown-elf-gcc    -c -o kernel/entry.o kernel/entry.S
</span></span><span style=display:flex><span>riscv64-unknown-elf-gcc -Wall -Werror -O -fno-omit-frame-pointer -ggdb -DSOL_UTIL -MD -mcmodel<span style=color:#f92672>=</span>medany -ffreestanding -fno-common -nostdlib -mno-relax -I. -fno-stack-protector -fno-pie -no-pie   -c -o kernel/start.o kernel/start.c
</span></span><span style=display:flex><span>riscv64-unknown-elf-gcc -Wall -Werror -O -fno-omit-frame-pointer -ggdb -DSOL_UTIL -MD -mcmodel<span style=color:#f92672>=</span>medany -ffreestanding -fno-common -nostdlib -mno-relax -I. -fno-stack-protector -fno-pie -no-pie   -c -o kernel/console.o kernel/console.c
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>nmeta <span style=color:#ae81ff>46</span> <span style=color:#f92672>(</span>boot, super, log blocks <span style=color:#ae81ff>30</span> inode blocks 13, bitmap blocks 1<span style=color:#f92672>)</span> blocks <span style=color:#ae81ff>954</span> total <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>balloc: first <span style=color:#ae81ff>591</span> blocks have been allocated
</span></span><span style=display:flex><span>balloc: write bitmap block at sector <span style=color:#ae81ff>45</span>
</span></span><span style=display:flex><span>qemu-system-riscv64 -machine virt -bios none -kernel kernel/kernel -m 128M -smp <span style=color:#ae81ff>3</span> -nographic -drive file<span style=color:#f92672>=</span>fs.img,if<span style=color:#f92672>=</span>none,format<span style=color:#f92672>=</span>raw,id<span style=color:#f92672>=</span>x0 -device virtio-blk-device,drive<span style=color:#f92672>=</span>x0,bus<span style=color:#f92672>=</span>virtio-mmio-bus.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>xv6 kernel is booting
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hart <span style=color:#ae81ff>2</span> starting
</span></span><span style=display:flex><span>hart <span style=color:#ae81ff>1</span> starting
</span></span><span style=display:flex><span>init: starting sh
</span></span><span style=display:flex><span>$
</span></span></code></pre></div><p>输入 <code>ls</code> 命令，可以查看当前目录下的所有信息</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ ls
</span></span><span style=display:flex><span>.              <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1024</span>
</span></span><span style=display:flex><span>..             <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1024</span>
</span></span><span style=display:flex><span>README         <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>2059</span>
</span></span><span style=display:flex><span>xargstest.sh   <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>93</span>
</span></span><span style=display:flex><span>cat            <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>23968</span>
</span></span><span style=display:flex><span>echo           <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>22800</span>
</span></span><span style=display:flex><span>forktest       <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>13168</span>
</span></span><span style=display:flex><span>grep           <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>7</span> <span style=color:#ae81ff>27320</span>
</span></span><span style=display:flex><span>init           <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>23896</span>
</span></span><span style=display:flex><span>kill           <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>9</span> <span style=color:#ae81ff>22768</span>
</span></span><span style=display:flex><span>ln             <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>22720</span>
</span></span><span style=display:flex><span>ls             <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>11</span> <span style=color:#ae81ff>26208</span>
</span></span><span style=display:flex><span>mkdir          <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>12</span> <span style=color:#ae81ff>22872</span>
</span></span><span style=display:flex><span>rm             <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>22856</span>
</span></span><span style=display:flex><span>sh             <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>14</span> <span style=color:#ae81ff>41752</span>
</span></span><span style=display:flex><span>stressfs       <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>23872</span>
</span></span><span style=display:flex><span>usertests      <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>16</span> <span style=color:#ae81ff>147512</span>
</span></span><span style=display:flex><span>grind          <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>37984</span>
</span></span><span style=display:flex><span>wc             <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>25104</span>
</span></span><span style=display:flex><span>zombie         <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>19</span> <span style=color:#ae81ff>22272</span>
</span></span><span style=display:flex><span>console        <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>通过执行 <code>Ctrl</code> + <code>p</code> 可以实现类似 <code>ps</code> 的操作，查看现在执行的所有进程</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> sleep  init
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span> sleep  sh
</span></span></code></pre></div><p>要退出qemu，执行 <code>Ctrl</code> - <code>a</code> <code>x</code></p><p><strong>注意</strong> 先按 <code>Ctrl</code> - <code>a</code> 松开后按 <code>x</code></p><h2 id=sleepeasy>sleep(easy)</h2><p>实现xv6的Unix程序睡眠；您的睡眠应该暂停一个用户指定的节拍数。计时是由xv6内核定义的时间概念，即来自计时器芯片的两个中断之间的时间。您的解决方案应该在文件USER/sleep.c中。</p><ul><li><p>首先应该阅读 <a href=https://pdos.csail.mit.edu/6.828/2020/xv6/book-riscv-rev1.pdf>https://pdos.csail.mit.edu/6.828/2020/xv6/book-riscv-rev1.pdf</a> xv6 book的第一章节</p></li><li><p>将文件实现放在 <code>user/</code> 目录下，可以参考其中的 echo.c, grep.c, rm.c 等</p></li><li><p>处理命令行参数个数问题</p></li><li><p>使用 <code>atoi()</code> 转换字符串到整型</p></li><li><p>使用系统调用sleep</p></li><li><p>查看 <code>kernel/sysproc.c</code> 中，xv6内核关于sleep系统调用的实现，以及 <code>user/usys.S</code> 关于汇编代码中跳转的部分</p></li><li><p>确保main函数执行完成后调用 exit()退出程序</p></li><li><p>将sleep加入到Makefile中的UPROGS变量中，以便在 <code>make qemu</code> 时，对其进行编译并能在xv6的shell中调用</p></li></ul><p>实现如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;kernel/types.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;kernel/stat.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;user/user.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>argv[]) 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(argc <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fprintf</span>(<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#34;Usage: sleep time...</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> n;
</span></span><span style=display:flex><span>    n <span style=color:#f92672>=</span> <span style=color:#a6e22e>atoi</span>(argv[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sleep</span>(n);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在makefile中添加</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=display:flex><span>UPROGS<span style=color:#f92672>=</span><span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_cat<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_echo<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_forktest<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_grep<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_init<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_kill<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_ln<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_ls<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_mkdir<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_rm<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_sh<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_stressfs<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_usertests<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_grind<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_wc<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_zombie<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	$U/_sleep<span style=color:#ae81ff>\
</span></span></span></code></pre></div><p>编译测试</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>make qemu
</span></span><span style=display:flex><span>riscv64-unknown-elf-gcc -Wall -Werror -O -fno-omit-frame-pointer -ggdb -DSOL_UTIL -MD -mcmodel<span style=color:#f92672>=</span>medany -ffreestanding -fno-common -nostdlib -mno-relax -I. -fno-stack-protector -fno-pie -no-pie   -c -o user/sleep.o user/sleep.c
</span></span><span style=display:flex><span>riscv64-unknown-elf-ld -z max-page-size<span style=color:#f92672>=</span><span style=color:#ae81ff>4096</span> -N -e main -Ttext <span style=color:#ae81ff>0</span> -o user/_sleep user/sleep.o user/ulib.o user/usys.o user/printf.o user/umalloc.o
</span></span><span style=display:flex><span>riscv64-unknown-elf-objdump -S user/_sleep &gt; user/sleep.asm
</span></span><span style=display:flex><span>riscv64-unknown-elf-objdump -t user/_sleep | sed <span style=color:#e6db74>&#39;1,/SYMBOL TABLE/d; s/ .* / /; /^$/d&#39;</span> &gt; user/sleep.sym
</span></span><span style=display:flex><span>mkfs/mkfs fs.img README  user/xargstest.sh user/_cat user/_echo user/_forktest user/_grep user/_init user/_kill user/_ln user/_ls user/_mkdir user/_rm user/_sh user/_stressfs user/_usertests user/_grind user/_wc user/_zombie user/_sleep
</span></span><span style=display:flex><span>nmeta <span style=color:#ae81ff>46</span> <span style=color:#f92672>(</span>boot, super, log blocks <span style=color:#ae81ff>30</span> inode blocks 13, bitmap blocks 1<span style=color:#f92672>)</span> blocks <span style=color:#ae81ff>954</span> total <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>balloc: first <span style=color:#ae81ff>615</span> blocks have been allocated
</span></span><span style=display:flex><span>balloc: write bitmap block at sector <span style=color:#ae81ff>45</span>
</span></span><span style=display:flex><span>qemu-system-riscv64 -machine virt -bios none -kernel kernel/kernel -m 128M -smp <span style=color:#ae81ff>3</span> -nographic -drive file<span style=color:#f92672>=</span>fs.img,if<span style=color:#f92672>=</span>none,format<span style=color:#f92672>=</span>raw,id<span style=color:#f92672>=</span>x0 -device virtio-blk-device,drive<span style=color:#f92672>=</span>x0,bus<span style=color:#f92672>=</span>virtio-mmio-bus.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>xv6 kernel is booting
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hart <span style=color:#ae81ff>1</span> starting
</span></span><span style=display:flex><span>hart <span style=color:#ae81ff>2</span> starting
</span></span><span style=display:flex><span>init: starting sh
</span></span><span style=display:flex><span>$ ls
</span></span><span style=display:flex><span>.              <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1024</span>
</span></span><span style=display:flex><span>..             <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1024</span>
</span></span><span style=display:flex><span>README         <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>2059</span>
</span></span><span style=display:flex><span>xargstest.sh   <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>93</span>
</span></span><span style=display:flex><span>cat            <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>23968</span>
</span></span><span style=display:flex><span>echo           <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>22800</span>
</span></span><span style=display:flex><span>forktest       <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>13168</span>
</span></span><span style=display:flex><span>grep           <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>7</span> <span style=color:#ae81ff>27320</span>
</span></span><span style=display:flex><span>init           <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>23896</span>
</span></span><span style=display:flex><span>kill           <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>9</span> <span style=color:#ae81ff>22768</span>
</span></span><span style=display:flex><span>ln             <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>22720</span>
</span></span><span style=display:flex><span>ls             <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>11</span> <span style=color:#ae81ff>26208</span>
</span></span><span style=display:flex><span>mkdir          <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>12</span> <span style=color:#ae81ff>22872</span>
</span></span><span style=display:flex><span>rm             <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>22856</span>
</span></span><span style=display:flex><span>sh             <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>14</span> <span style=color:#ae81ff>41752</span>
</span></span><span style=display:flex><span>stressfs       <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>23872</span>
</span></span><span style=display:flex><span>usertests      <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>16</span> <span style=color:#ae81ff>147512</span>
</span></span><span style=display:flex><span>grind          <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>37984</span>
</span></span><span style=display:flex><span>wc             <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>25104</span>
</span></span><span style=display:flex><span>zombie         <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>19</span> <span style=color:#ae81ff>22272</span>
</span></span><span style=display:flex><span>sleep          <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>22744</span>
</span></span><span style=display:flex><span>console        <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>21</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>$ sleep <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>$
</span></span></code></pre></div><p>执行成功</p><h2 id=pingpongeasy>pingpong(easy)</h2><p>实现一个程序，fork一个子进程，在父进程和子进程之间，使用pipe管道进行信息的传递与发送，最后按照格式输出相应的内容和进程号。</p><p>需要查看xv6 book 1.2和1.3章节的相关内容</p><p>具体实现如下。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;kernel/types.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;kernel/stat.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;user/user.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>argv[]) 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> p1[<span style=color:#ae81ff>2</span>], p2[<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pipe</span>(p1);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pipe</span>(p2);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>fork</span>() <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>char</span> buf[<span style=color:#ae81ff>20</span>];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> fd1 <span style=color:#f92672>=</span> <span style=color:#a6e22e>dup</span>(p1[<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>read</span>(fd1, buf, <span style=color:#66d9ef>sizeof</span>(buf));
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>strcmp</span>(<span style=color:#e6db74>&#34;ping&#34;</span>, buf) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%d:received ping</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#a6e22e>getpid</span>());
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>write</span>(p2[<span style=color:#ae81ff>1</span>], <span style=color:#e6db74>&#34;pong</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>close</span>(p1[<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>close</span>(p1[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>close</span>(p2[<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>close</span>(p2[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>write</span>(p1[<span style=color:#ae81ff>1</span>], <span style=color:#e6db74>&#34;ping</span><span style=color:#ae81ff>\0</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>char</span> buf[<span style=color:#ae81ff>20</span>];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> fd2 <span style=color:#f92672>=</span> <span style=color:#a6e22e>dup</span>(p2[<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>read</span>(fd2, buf, <span style=color:#66d9ef>sizeof</span>(buf));
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>strcmp</span>(<span style=color:#e6db74>&#34;pong&#34;</span>, buf) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%d:received pong</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#a6e22e>getpid</span>());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>close</span>(p1[<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>close</span>(p1[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>close</span>(p2[<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>close</span>(p2[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>将其加入到makefile后，编译执行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ pingpong
</span></span><span style=display:flex><span>4:received ping
</span></span><span style=display:flex><span>3:received pong
</span></span><span style=display:flex><span>$
</span></span></code></pre></div><p>执行成功</p><ul class=pa0><li class="list di"><a href=/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">操作系统</a></li><li class="list di"><a href=/tags/6.s081/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">6.S081</a></li><li class="list di"><a href=/tags/utilities/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Utilities</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">相关內容</p><ul class="pa0 list"><li class=mb2><a href=/posts/oslab/6.s081%E7%AE%80%E4%BB%8B%E4%B8%8E%E5%AE%89%E8%A3%85/>6.S081安装</a></li></ul></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://flyingsnow31.github.io/>&copy; Flying Snow Blog 2022</a><div><div class=ananke-socials><a href=https://gitee.com/li_zengyi target=_blank class="Gitee ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Gitee link" rel=noopener aria-label="follow on Gitee——Opens in a new window">Gitee
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/flyingsnow31 target=_blank class="GitHub ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">GitHub
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>