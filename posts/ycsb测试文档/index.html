<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>YCSB测试文档 | Flying Snow Blog</title><meta name=keywords content="YCSB"><meta name=description content="YCSB测试文档 测试工具 使用YCSB进行测试
简介 Yahoo! Cloud Serving Benchmark (YCSB) 。
Yahoo公司的一个用来对云服务进行基础测试的工具。
使用Java语言实现，如果需要对一个数据库进行性能测试
需要通过java编写客户端代码
YCSB自带了很多主流数据库的客户端代码，可以直接使用
https://github.com/brianfrankcooper/YCSB
安装使用 编译环境 需要Maven 3, java >= 8
编译 由于网络原因，可能需要对maven进行换源
参考 (22条消息) Ubuntu20安装maven并切换阿里镜像源_一时半会想不出的博客-CSDN博客_maven ubuntu 换源
git clone https://github.com/brianfrankcooper/YCSB cd YCSB # 编译所有数据库客户端 mvn clean package # 编译指定数据库客户端。e.g. mongodb mvn -pl site.ycsb:mongodb-binding -am clean package 对于指定数据库如何编译使用，可以在代码clone下来后，进入指定数据库名字的目录内README文件查看
运行 推荐使用 shell 脚本执行。
执行文件在 ./bin 中，共有四个文件，其中执行文件有三种，分别为python2，shell与bat文件。
如使用shell脚本，记得将所有readme文件中的 ./bin/ycsb 更换为 ./bin/ycsb.sh
这三个执行文件的逻辑是：解析命令行、设置java环境，加载java-libs，封装成可以执行的java命令，并执行
# 命令参数 ./bin/ycsb.sh [command] [database] [options] # [command] # load: 载入数据 # run: 执行测试 # [database] #	指定测试的数据库 #	redis, rocksdb."><meta name=author content="LZY"><link rel=canonical href=https://flyingsnow31.github.io/posts/ycsb%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://flyingsnow31.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://flyingsnow31.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://flyingsnow31.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://flyingsnow31.github.io/apple-touch-icon.png><link rel=mask-icon href=https://flyingsnow31.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="YCSB测试文档"><meta property="og:description" content="YCSB测试文档 测试工具 使用YCSB进行测试
简介 Yahoo! Cloud Serving Benchmark (YCSB) 。
Yahoo公司的一个用来对云服务进行基础测试的工具。
使用Java语言实现，如果需要对一个数据库进行性能测试
需要通过java编写客户端代码
YCSB自带了很多主流数据库的客户端代码，可以直接使用
https://github.com/brianfrankcooper/YCSB
安装使用 编译环境 需要Maven 3, java >= 8
编译 由于网络原因，可能需要对maven进行换源
参考 (22条消息) Ubuntu20安装maven并切换阿里镜像源_一时半会想不出的博客-CSDN博客_maven ubuntu 换源
git clone https://github.com/brianfrankcooper/YCSB cd YCSB # 编译所有数据库客户端 mvn clean package # 编译指定数据库客户端。e.g. mongodb mvn -pl site.ycsb:mongodb-binding -am clean package 对于指定数据库如何编译使用，可以在代码clone下来后，进入指定数据库名字的目录内README文件查看
运行 推荐使用 shell 脚本执行。
执行文件在 ./bin 中，共有四个文件，其中执行文件有三种，分别为python2，shell与bat文件。
如使用shell脚本，记得将所有readme文件中的 ./bin/ycsb 更换为 ./bin/ycsb.sh
这三个执行文件的逻辑是：解析命令行、设置java环境，加载java-libs，封装成可以执行的java命令，并执行
# 命令参数 ./bin/ycsb.sh [command] [database] [options] # [command] # load: 载入数据 # run: 执行测试 # [database] #	指定测试的数据库 #	redis, rocksdb."><meta property="og:type" content="article"><meta property="og:url" content="https://flyingsnow31.github.io/posts/ycsb%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-04T20:08:22+08:00"><meta property="article:modified_time" content="2023-02-04T20:08:22+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="YCSB测试文档"><meta name=twitter:description content="YCSB测试文档 测试工具 使用YCSB进行测试
简介 Yahoo! Cloud Serving Benchmark (YCSB) 。
Yahoo公司的一个用来对云服务进行基础测试的工具。
使用Java语言实现，如果需要对一个数据库进行性能测试
需要通过java编写客户端代码
YCSB自带了很多主流数据库的客户端代码，可以直接使用
https://github.com/brianfrankcooper/YCSB
安装使用 编译环境 需要Maven 3, java >= 8
编译 由于网络原因，可能需要对maven进行换源
参考 (22条消息) Ubuntu20安装maven并切换阿里镜像源_一时半会想不出的博客-CSDN博客_maven ubuntu 换源
git clone https://github.com/brianfrankcooper/YCSB cd YCSB # 编译所有数据库客户端 mvn clean package # 编译指定数据库客户端。e.g. mongodb mvn -pl site.ycsb:mongodb-binding -am clean package 对于指定数据库如何编译使用，可以在代码clone下来后，进入指定数据库名字的目录内README文件查看
运行 推荐使用 shell 脚本执行。
执行文件在 ./bin 中，共有四个文件，其中执行文件有三种，分别为python2，shell与bat文件。
如使用shell脚本，记得将所有readme文件中的 ./bin/ycsb 更换为 ./bin/ycsb.sh
这三个执行文件的逻辑是：解析命令行、设置java环境，加载java-libs，封装成可以执行的java命令，并执行
# 命令参数 ./bin/ycsb.sh [command] [database] [options] # [command] # load: 载入数据 # run: 执行测试 # [database] #	指定测试的数据库 #	redis, rocksdb."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://flyingsnow31.github.io/posts/"},{"@type":"ListItem","position":2,"name":"YCSB测试文档","item":"https://flyingsnow31.github.io/posts/ycsb%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"YCSB测试文档","name":"YCSB测试文档","description":"YCSB测试文档 测试工具 使用YCSB进行测试\n简介 Yahoo! Cloud Serving Benchmark (YCSB) 。\nYahoo公司的一个用来对云服务进行基础测试的工具。\n使用Java语言实现，如果需要对一个数据库进行性能测试\n需要通过java编写客户端代码\nYCSB自带了很多主流数据库的客户端代码，可以直接使用\nhttps://github.com/brianfrankcooper/YCSB\n安装使用 编译环境 需要Maven 3, java \u0026gt;= 8\n编译 由于网络原因，可能需要对maven进行换源\n参考 (22条消息) Ubuntu20安装maven并切换阿里镜像源_一时半会想不出的博客-CSDN博客_maven ubuntu 换源\ngit clone https://github.com/brianfrankcooper/YCSB cd YCSB # 编译所有数据库客户端 mvn clean package # 编译指定数据库客户端。e.g. mongodb mvn -pl site.ycsb:mongodb-binding -am clean package 对于指定数据库如何编译使用，可以在代码clone下来后，进入指定数据库名字的目录内README文件查看\n运行 推荐使用 shell 脚本执行。\n执行文件在 ./bin 中，共有四个文件，其中执行文件有三种，分别为python2，shell与bat文件。\n如使用shell脚本，记得将所有readme文件中的 ./bin/ycsb 更换为 ./bin/ycsb.sh\n这三个执行文件的逻辑是：解析命令行、设置java环境，加载java-libs，封装成可以执行的java命令，并执行\n# 命令参数 ./bin/ycsb.sh [command] [database] [options] # [command] # load: 载入数据 # run: 执行测试 # [database] #\t指定测试的数据库 #\tredis, rocksdb.","keywords":["YCSB"],"articleBody":"YCSB测试文档 测试工具 使用YCSB进行测试\n简介 Yahoo! Cloud Serving Benchmark (YCSB) 。\nYahoo公司的一个用来对云服务进行基础测试的工具。\n使用Java语言实现，如果需要对一个数据库进行性能测试\n需要通过java编写客户端代码\nYCSB自带了很多主流数据库的客户端代码，可以直接使用\nhttps://github.com/brianfrankcooper/YCSB\n安装使用 编译环境 需要Maven 3, java \u003e= 8\n编译 由于网络原因，可能需要对maven进行换源\n参考 (22条消息) Ubuntu20安装maven并切换阿里镜像源_一时半会想不出的博客-CSDN博客_maven ubuntu 换源\ngit clone https://github.com/brianfrankcooper/YCSB cd YCSB # 编译所有数据库客户端 mvn clean package # 编译指定数据库客户端。e.g. mongodb mvn -pl site.ycsb:mongodb-binding -am clean package 对于指定数据库如何编译使用，可以在代码clone下来后，进入指定数据库名字的目录内README文件查看\n运行 推荐使用 shell 脚本执行。\n执行文件在 ./bin 中，共有四个文件，其中执行文件有三种，分别为python2，shell与bat文件。\n如使用shell脚本，记得将所有readme文件中的 ./bin/ycsb 更换为 ./bin/ycsb.sh\n这三个执行文件的逻辑是：解析命令行、设置java环境，加载java-libs，封装成可以执行的java命令，并执行\n# 命令参数 ./bin/ycsb.sh [command] [database] [options] # [command] # load: 载入数据 # run: 执行测试 # [database] #\t指定测试的数据库 #\tredis, rocksdb... # [options] # -P file: 指定workload文件 #\t-p key=value: 设置ycsb配置项目，会覆盖或增加workload文件的配置 # -s: 中间状态打印到stderr中 # -threads n: ycsb客户端的并发测试线程数目，默认是1 Workloads 在 workloads 目录下，提供了workload的模板以及一些默认workload\nworkload名 具体细节 workloada 0.5/0.5, reads/writes workloadb 0.95/0.05, reads/writes workloadc 1, read workloadd 0.95/0.05, reads/insert workloade 0.95/0.05, scan/insert workloadf 0.5/0.5, reads/insert workload文件具体配置\n参数项 具体含义 recordcount YCSB load阶段加载的记录条数 operationcount YCSB run阶段执行的操作总数 workload workload实现类 readallfields 查询时是否读取记录的所有字段 readproportion 读操作的百分比 updateproportion 更新操作的百分比 scanproportion 插入操作的百分比 requestdistribution 请求分布模式，uniform, zipfian, latest三种分布模式 执行过程 一般为先 load 再 run load 为将所需的数据生成并写入到指定数据库中\nrun 为具体执行workload中的操作\n测试结果 参数 含义 RunTime(ms) 数据加载所用时间,单位毫秒(ms) Throughput(ops/sec) 吞吐量,即ops(每秒操作次数) Operations 操作的总次数 AverageLatency(us) 平均响应延时,单位是微秒(us) MinLatency(us) 最小响应时间,单位是微秒(us) MaxLatency(us) 最大响应时间,单位是微秒(us) 95thPercentileLatency(us) 95%的操作延时,单位是微秒(us) 99thPercentileLatency(us) 99%的操作延时,单位是微秒(us) Return=OK 成功返回数 [READ] 开头表示 READ 操作执行的具体情况，其他类似\n参考 YCSB数据库性能测试工具 - 简书 (jianshu.com)\nKvrocks 简介 Kvrocks 是基于 RocksDB 之上兼容 Redis 协议的 NoSQL 存储服务，设计目标是提供一个低成本以及大容量的 Redis 服务，作为 Redis 在大数据量场景的互补服务，选择兼容 Redis 协议是因为简单易用且业务迁移成本低。\nhttps://github.com/apache/incubator-kvrocks\n安装使用 先决条件 # Ubuntu / Debian sudo apt update sudo apt install -y git gcc g++ make cmake autoconf automake libtool python3 libssl-dev 编译 git clone https://github.com/apache/incubator-kvrocks.git cd incubator-kvrocks ./x.py build # `./x.py build -h` to check more options; # especially, `./x.py build --ghproxy` will fetch dependencies via ghproxy.com. 运行 配置文件 kvrocks.conf 位于软件根目录\n./build/kvrocks -c kvrocks.conf 连接服务 redis-cli -p 6666 127.0.0.1:6666\u003e PING PONG 使用YCSB进行测试 由于kvrocks接口兼容redis协议，于是使用ycsb中的redis\nycsb编译 mvn -pl site.ycsb:redis-binding -am clean package 运行kvrock 修改 kvrocks.conf ，将db文件目录修改到指定地方，这里修改为750上的一块通过pcie连接的ssd\n# The working directory # # The DB will be written inside this directory # Note that you must specify a directory here, not a file name. dir /mnt/nvme/kvrocks 运行\n./build/kvrocks -c kvrocks.conf 运行ycsb进行测试 ./bin/ycsb.sh load redis -s -P workloads/workloada -threads 28 -p redis.host=127.0.0.1 -p redis.port=6666 报错 /usr/bin/java -classpath /home/lzy/ycsb-0.17.0/conf:/home/lzy/ycsb-0.17.0/lib/HdrHistogram-2.1.4.jar:/home/lzy/ycsb-0.17.0/lib/core-0.17.0.jar:/home/lzy/ycsb-0.17.0/lib/htrace-core4-4.1.0-incubating.jar:/home/lzy/ycsb-0.17.0/lib/jackson-core-asl-1.9.4.jar:/home/lzy/ycsb-0.17.0/lib/jackson-mapper-asl-1.9.4.jar:/home/lzy/ycsb-0.17.0/redis-binding/lib/commons-pool2-2.4.2.jar:/home/lzy/ycsb-0.17.0/redis-binding/lib/jedis-2.9.0.jar:/home/lzy/ycsb-0.17.0/redis-binding/lib/redis-binding-0.17.0.jar site.ycsb.Client -load -db site.ycsb.db.RedisClient -s -P workloads/workloada -threads 28 -p redis.host=127.0.0.1 -p redis.port=6666 redis.clients.jedis.exceptions.JedisConnectionException: java.net.SocketTimeoutException: Read timed out at redis.clients.util.RedisInputStream.ensureFill(RedisInputStream.java:202) at redis.clients.util.RedisInputStream.readByte(RedisInputStream.java:40) at redis.clients.jedis.Protocol.process(Protocol.java:151) at redis.clients.jedis.Protocol.read(Protocol.java:215) at redis.clients.jedis.Connection.readProtocolWithCheckingBroken(Connection.java:340) at redis.clients.jedis.Connection.getIntegerReply(Connection.java:265) at redis.clients.jedis.Jedis.zadd(Jedis.java:1385) at site.ycsb.db.RedisClient.insert(RedisClient.java:141) at site.ycsb.DBWrapper.insert(DBWrapper.java:221) at site.ycsb.workloads.CoreWorkload.doInsert(CoreWorkload.java:601) at site.ycsb.ClientThread.run(ClientThread.java:135) at java.base/java.lang.Thread.run(Thread.java:829) Caused by: java.net.SocketTimeoutException: Read timed out at java.base/java.net.SocketInputStream.socketRead0(Native Method) at java.base/java.net.SocketInputStream.socketRead(SocketInputStream.java:115) at java.base/java.net.SocketInputStream.read(SocketInputStream.java:168) at java.base/java.net.SocketInputStream.read(SocketInputStream.java:140) at java.base/java.net.SocketInputStream.read(SocketInputStream.java:126) at redis.clients.util.RedisInputStream.ensureFill(RedisInputStream.java:196) ... 11 more 问题分析 参考\n(22条消息) jedis的Read timed out异常解决_逆光飞翔2018的博客-CSDN博客_jedis read timeout\nredis.clients.jedis.exceptions.JedisConnectionException: java.net.SocketTimeoutException: Read timed out 表面客户端与服务端的socket连接超时，主要原因推测为数据量过大，导致服务端延时较长。\n通过查看ycsb的redis客户端源码，默认的客户端延时为2秒，所以当超时后，客户端主动关闭了连接。\npublic static final String TIMEOUT_PROPERTY = \"redis.timeout\"; jedis = new Jedis(host, port, Integer.parseInt(redisTimeout)); 需要修改jedis的timeout参数，通过在执行ycsb时，使用 -p 参数，指定 redis.timeout 修改成一个比较大的值即可\n同时需要修改kvrocks.conf\n# line 26 # Close the connection after a client is idle for N seconds (0 to disable) timeout 100000 # The number of worker's threads, increase or decrease would affect the performance. workers 28 完整正确的启动流程 使用 numactl -N 0\n启动kvrocks numactl -N 0 ./build/kvrocks -c kvrocks.conf 启动ycsb的load numactl -N 0 ./bin/ycsb.sh load redis -s -P workloads/workloada -threads 28 -p redis.host=127.0.0.1 -p redis.port=6666 -p redis.timeout=100000 执行ycsb的run numactl -N 0 ./bin/ycsb.sh run redis -s -P workloads/workloada -threads 28 -p redis.host=127.0.0.1 -p redis.port=6666 -p redis.timeout=100000 收集完成执行结果\n关闭kvrocks\n删除其在硬盘中的数据\nrm -r /mnt/nvme/kvrocks/* 测试指标 在750机器上进行测试\nycsb使用28线程，kvrocks的worker也使用28，不限制硬盘空间，默认worker数为8+\n主要收集吞吐率，平均延时，95%延时和99%延时的数据\nredis 简介 Redis（Remote Dictionary Server )，即远程字典服务，是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。\nhttps://github.com/redis/redis\n安装使用 # 下载源码 wget https://download.redis.io/redis-stable.tar.gz # 编译 tar -xzvf redis-stable.tar.gz cd redis-stable make 运行 编译后的可执行文件位于 ./src 中\n服务端为 redis-server ，客户端为 redis-cli\n./src/redis-server \u0026 ./src/redis-cli 127.0.0.1\u003ePING PONG 配置 配置文件位于软件根目录下的 redis.conf 中\n如果需要使用配置文件，使用如下命令启动\n./src/redis-server redis.conf 使用YCSB进行测试 ycsb编译 编译与对kvrocks进行测试的方式相同\nmvn -pl site.ycsb:redis-binding -am clean package 运行redis 选择是否启动持久化，以及持久化的存放目录\n# Save the DB to disk. # # save [ ...] # # Redis will save the DB if the given number of seconds elapsed and it # surpassed the given number of write operations against the DB. # # Snapshotting can be completely disabled with a single empty string argument # as in following example: # # save \"\" # # Unless specified otherwise, by default Redis will save the DB: # * After 3600 seconds (an hour) if at least 1 change was performed # * After 300 seconds (5 minutes) if at least 100 changes were performed # * After 60 seconds if at least 10000 changes were performed # # You can set these explicitly by uncommenting the following line. # # save 3600 1 300 100 60 10000 # The working directory. # # The DB will be written inside this directory, with the filename specified # above using the 'dbfilename' configuration directive. # # The Append Only File will also be created inside this directory. # # Note that you must specify a directory here, not a file name. dir /mnt/nvme/redis 使用指定配置启动redis\n./src/redis-server redis.conf 运行ycsb进行测试 ./bin/ycsb.sh load redis -s -P workloads/workloada -threads 28 -p redis.host=127.0.0.1 -p redis.port=6379 ./bin/ycsb.sh run redis -s -P workloads/workloada -threads 28 -p redis.host=127.0.0.1 -p redis.port=6379 测试指标 测试开启持久化与关闭持久化下的性能\n主要收集吞吐率，平均延时，95%延时和99%延时的数据\nRocksDB 简介 RocksDB是FaceBook起初作为实验性质开发的，旨在充分实现快存上存储数据的服务能力。由Facebook的Dhruba Borthakur于2012年4月创建的LevelDB的分支，最初的目标是提高服务工作负载的性能，最大限度的发挥闪存和RAM的高度率读写性能。\nKey和value是任意大小的字节流支持原子的读和写。除此外，RocksDB深度支持各种配置，可以在不同的生产环境（纯内存、Flash、hard disks or HDFS）中调优，RocksDB针对多核CPU、高效快速存储（SSD)、I/O bound workload做了优化，支持不同的数据压缩算法、和生产环境debug的完善工具。\nhttps://github.com/facebook/rocksdb\n安装使用 依赖 zlib - a library for data compression. bzip2 - a library for data compression. lz4 - a library for extremely fast data compression. snappy - a library for fast data compression. zstandard - Fast real-time compression algorithm. gcc \u003e= 7\n编译 git clone https://github.com/facebook/rocksdb.git cd rocksdb make static_lib # will compile librocksdb.a, RocksDB static library. Compiles static library in release mode. make shared_lib # will compile librocksdb.so, RocksDB shared library. Compiles shared library in release mode. 运行 rocksdb是一个嵌入式的数据库，与redis不同，是通过链接库连接到应用上，与应用一同运行。\n使用YCSB进行测试 由于rocksdb嵌入式的特性，ycsb通过maven提供了rocksdb的下载，在rocksdb的目录中pom.xml文件可以看到\norg.rocksdb rocksdbjni ${rocksdb.version} 这里会下载rocksdb在maven仓库中最新的版本，一般为6。可以下载下来直接进行测试，可直接跳到ycsb编译部分\nrocksdb java版本 参考\n(22条消息) 【测试】自定义配置 RocksDB 进行 YCSB 测试_ywang_wnlo的博客-CSDN博客\nMaven添加本地jar包 - 赵羴 - 博客园 (cnblogs.com)\n如果需要使用指定的版本，或者使用rocksdb的最新编译版本，首先需要用java对rocksdb进行编译\njava \u003e=8\n注意需要修改rocksdb的makefile\n238：ROCKSDB_DISABLE_MEMKIND=true 这里关闭rocksdb的MEMKIND，否则在运行ycsb时，会报如下错误\nINFO site.ycsb.db.rocksdb.RocksDBClient - RocksDB data dir: /mnt/nvme/rocksdb 2022-10-31 16:24:26:554 0 sec: 0 operations; est completion in 0 second Exception in thread \"Thread-23\" java.lang.UnsatisfiedLinkError: /tmp/librocksdbjni5496689695031159979.so: /tmp/librocksdbjni5496689695031159979.so: undefined symbol: MEMKIND_DAX_KMEM 然后编译java版本的rocksdb\n# 安装依赖 sudo apt-get install libgflags-dev libsnappy-dev zlib1g-dev libbz2-dev liblz4-dev libzstd-dev # 配置环境变量 export JAVA_HOME=\"/usr/lib/jvm/java-11-openjdk-amd64\" # 编译release版本 make -j$(nproc) rocksdbjavastatic 编译好的文件位于 rocksdb/java/target/rocksdbjni-7.8.0-linux64.jar\n然后将此jar文件加入到本地的maven仓库中\nmvn install:install-file -Dfile= -DgroupId= -DartifactId= -Dversion= -Dpackaging= -DgeneratePom=true Where: the path to the file to load the group that the file should be registered under the artifact name for the file the version of the file the packaging of the file e.g. jar 修改ycsb中rocksdb的pom.xml中对应指定的版本等信息\nycsb编译 mvn -pl site.ycsb:rocksdb-binding -am clean package 运行ycsb进行测试 # 装载数据 ./bin/ycsb.sh load rocksdb -s -P workloads/workloada -threads 28 -p rocksdb.dir=/mnt/nvme/rocksdb # 运行 ./bin/ycsb.sh run rocksdb -s -P workloads/workloada -threads 28 -p rocksdb.dir=/mnt/nvme/rocksdb 配置 rocksdb.dir 指定了rocksdb运行时数据存放在硬盘上的位置\nrocksdb.optionsfile 指定了运行时rocksdb的配置，可选，如果为空，使用ycsb提供的默认配置\n测试指标 主要收集吞吐率，平均延时，95%延时和99%延时的数据\n","wordCount":"1052","inLanguage":"zh","datePublished":"2023-02-04T20:08:22+08:00","dateModified":"2023-02-04T20:08:22+08:00","author":{"@type":"Person","name":"LZY"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://flyingsnow31.github.io/posts/ycsb%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3/"},"publisher":{"@type":"Organization","name":"Flying Snow Blog","logo":{"@type":"ImageObject","url":"https://flyingsnow31.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://flyingsnow31.github.io/ accesskey=h title="Flying Snow Blog (Alt + H)">Flying Snow Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://flyingsnow31.github.io/ title=首页><span>首页</span></a></li><li><a href=https://flyingsnow31.github.io/posts/ title=归档><span>归档</span></a></li><li><a href=https://flyingsnow31.github.io/tags/ title=标签><span>标签</span></a></li><li><a href=https://flyingsnow31.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://flyingsnow31.github.io/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>YCSB测试文档</h1><div class=post-meta><span title='2023-02-04 20:08:22 +0800 +0800'>二月 4, 2023</span>&nbsp;·&nbsp;LZY</div></header><div class=post-content><h1 id=ycsb测试文档>YCSB测试文档<a hidden class=anchor aria-hidden=true href=#ycsb测试文档>#</a></h1><h2 id=测试工具>测试工具<a hidden class=anchor aria-hidden=true href=#测试工具>#</a></h2><p>使用YCSB进行测试</p><h3 id=简介>简介<a hidden class=anchor aria-hidden=true href=#简介>#</a></h3><p>Yahoo! Cloud Serving Benchmark (YCSB) 。</p><p>Yahoo公司的一个用来对云服务进行基础测试的工具。</p><p>使用Java语言实现，如果需要对一个数据库进行性能测试</p><p>需要通过java编写客户端代码</p><p>YCSB自带了很多主流数据库的客户端代码，可以直接使用</p><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fbrianfrankcooper%2FYCSB">https://github.com/brianfrankcooper/YCSB</a></p><h3 id=安装使用>安装使用<a hidden class=anchor aria-hidden=true href=#安装使用>#</a></h3><h4 id=编译环境>编译环境<a hidden class=anchor aria-hidden=true href=#编译环境>#</a></h4><p>需要Maven 3, java >= 8</p><h4 id=编译>编译<a hidden class=anchor aria-hidden=true href=#编译>#</a></h4><blockquote><p>由于网络原因，可能需要对maven进行换源</p><p>参考 <a href=https://blog.csdn.net/a1587943743/article/details/122134892>(22条消息) Ubuntu20安装maven并切换阿里镜像源_一时半会想不出的博客-CSDN博客_maven ubuntu 换源</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git clone https://github.com/brianfrankcooper/YCSB
</span></span><span style=display:flex><span>cd YCSB
</span></span><span style=display:flex><span><span style=color:#75715e># 编译所有数据库客户端</span>
</span></span><span style=display:flex><span>mvn clean package 
</span></span><span style=display:flex><span><span style=color:#75715e># 编译指定数据库客户端。e.g. mongodb</span>
</span></span><span style=display:flex><span>mvn -pl site.ycsb:mongodb-binding -am clean package
</span></span></code></pre></div><p>对于指定数据库如何编译使用，可以在代码clone下来后，进入指定数据库名字的目录内README文件查看</p><h4 id=运行>运行<a hidden class=anchor aria-hidden=true href=#运行>#</a></h4><p><strong>推荐</strong>使用 shell 脚本执行。</p><p>执行文件在 <code>./bin</code> 中，共有四个文件，其中执行文件有三种，分别为python2，shell与bat文件。</p><p>如使用shell脚本，记得将所有readme文件中的 <code>./bin/ycsb</code> 更换为 <code>./bin/ycsb.sh</code></p><p>这三个执行文件的逻辑是：解析命令行、设置java环境，加载java-libs，封装成可以执行的java命令，并执行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 命令参数</span>
</span></span><span style=display:flex><span>./bin/ycsb.sh <span style=color:#f92672>[</span>command<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>database<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>options<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#75715e># [command]</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 	load: 载入数据</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 	run: 执行测试</span>
</span></span><span style=display:flex><span><span style=color:#75715e># [database]</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#	指定测试的数据库</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#	redis, rocksdb...</span>
</span></span><span style=display:flex><span><span style=color:#75715e># [options]</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 	-P file: 指定workload文件</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#	-p key=value: 设置ycsb配置项目，会覆盖或增加workload文件的配置</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 	-s: 中间状态打印到stderr中</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 	-threads n: ycsb客户端的并发测试线程数目，默认是1</span>
</span></span></code></pre></div><h4 id=workloads>Workloads<a hidden class=anchor aria-hidden=true href=#workloads>#</a></h4><p>在 workloads 目录下，提供了workload的模板以及一些默认workload</p><table><thead><tr><th>workload名</th><th>具体细节</th></tr></thead><tbody><tr><td>workloada</td><td>0.5/0.5, reads/writes</td></tr><tr><td>workloadb</td><td>0.95/0.05, reads/writes</td></tr><tr><td>workloadc</td><td>1, read</td></tr><tr><td>workloadd</td><td>0.95/0.05, reads/insert</td></tr><tr><td>workloade</td><td>0.95/0.05, scan/insert</td></tr><tr><td>workloadf</td><td>0.5/0.5, reads/insert</td></tr></tbody></table><p>workload文件具体配置</p><table><thead><tr><th>参数项</th><th>具体含义</th></tr></thead><tbody><tr><td>recordcount</td><td>YCSB load阶段加载的记录条数</td></tr><tr><td>operationcount</td><td>YCSB run阶段执行的操作总数</td></tr><tr><td>workload</td><td>workload实现类</td></tr><tr><td>readallfields</td><td>查询时是否读取记录的所有字段</td></tr><tr><td>readproportion</td><td>读操作的百分比</td></tr><tr><td>updateproportion</td><td>更新操作的百分比</td></tr><tr><td>scanproportion</td><td>插入操作的百分比</td></tr><tr><td>requestdistribution</td><td>请求分布模式，uniform, zipfian, latest三种分布模式</td></tr></tbody></table><h4 id=执行过程>执行过程<a hidden class=anchor aria-hidden=true href=#执行过程>#</a></h4><p>一般为先 <code>load</code> 再 <code>run</code></p><p>load 为将所需的数据生成并写入到指定数据库中</p><p>run 为具体执行workload中的操作</p><h4 id=测试结果>测试结果<a hidden class=anchor aria-hidden=true href=#测试结果>#</a></h4><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>RunTime(ms)</td><td>数据加载所用时间,单位毫秒(ms)</td></tr><tr><td>Throughput(ops/sec)</td><td>吞吐量,即ops(每秒操作次数)</td></tr><tr><td>Operations</td><td>操作的总次数</td></tr><tr><td>AverageLatency(us)</td><td>平均响应延时,单位是微秒(us)</td></tr><tr><td>MinLatency(us)</td><td>最小响应时间,单位是微秒(us)</td></tr><tr><td>MaxLatency(us)</td><td>最大响应时间,单位是微秒(us)</td></tr><tr><td>95thPercentileLatency(us)</td><td>95%的操作延时,单位是微秒(us)</td></tr><tr><td>99thPercentileLatency(us)</td><td>99%的操作延时,单位是微秒(us)</td></tr><tr><td>Return=OK</td><td>成功返回数</td></tr></tbody></table><p>[READ] 开头表示 <code>READ</code> 操作执行的具体情况，其他类似</p><h3 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h3><p><a href=https://www.jianshu.com/p/66937631bf0b>YCSB数据库性能测试工具 - 简书 (jianshu.com)</a></p><h2 id=kvrocks>Kvrocks<a hidden class=anchor aria-hidden=true href=#kvrocks>#</a></h2><h3 id=简介-1>简介<a hidden class=anchor aria-hidden=true href=#简介-1>#</a></h3><p>Kvrocks 是基于 RocksDB 之上兼容 Redis 协议的 NoSQL 存储服务，设计目标是提供一个低成本以及大容量的 Redis 服务，作为 Redis 在大数据量场景的互补服务，选择兼容 Redis 协议是因为简单易用且业务迁移成本低。</p><p><a href=https://github.com/apache/incubator-kvrocks>https://github.com/apache/incubator-kvrocks</a></p><h3 id=安装使用-1>安装使用<a hidden class=anchor aria-hidden=true href=#安装使用-1>#</a></h3><h4 id=先决条件>先决条件<a hidden class=anchor aria-hidden=true href=#先决条件>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Ubuntu / Debian</span>
</span></span><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install -y git gcc g++ make cmake autoconf automake libtool python3 libssl-dev
</span></span></code></pre></div><h4 id=编译-1>编译<a hidden class=anchor aria-hidden=true href=#编译-1>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git clone https://github.com/apache/incubator-kvrocks.git
</span></span><span style=display:flex><span>cd incubator-kvrocks
</span></span><span style=display:flex><span>./x.py build <span style=color:#75715e># `./x.py build -h` to check more options;</span>
</span></span><span style=display:flex><span>               <span style=color:#75715e># especially, `./x.py build --ghproxy` will fetch dependencies via ghproxy.com.</span>
</span></span></code></pre></div><h4 id=运行-1>运行<a hidden class=anchor aria-hidden=true href=#运行-1>#</a></h4><p>配置文件 <code>kvrocks.conf</code> 位于软件根目录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./build/kvrocks -c kvrocks.conf
</span></span></code></pre></div><h4 id=连接服务>连接服务<a hidden class=anchor aria-hidden=true href=#连接服务>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>redis-cli -p <span style=color:#ae81ff>6666</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>127.0.0.1:6666&gt; PING
</span></span><span style=display:flex><span>PONG
</span></span></code></pre></div><h3 id=使用ycsb进行测试>使用YCSB进行测试<a hidden class=anchor aria-hidden=true href=#使用ycsb进行测试>#</a></h3><p>由于kvrocks接口兼容redis协议，于是使用ycsb中的redis</p><h4 id=ycsb编译>ycsb编译<a hidden class=anchor aria-hidden=true href=#ycsb编译>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mvn -pl site.ycsb:redis-binding -am clean package
</span></span></code></pre></div><h4 id=运行kvrock>运行kvrock<a hidden class=anchor aria-hidden=true href=#运行kvrock>#</a></h4><p>修改 <code>kvrocks.conf</code> ，将db文件目录修改到指定地方，这里修改为750上的一块通过pcie连接的ssd</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># The working directory</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># The DB will be written inside this directory</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Note that you must specify a directory here, not a file name.</span>
</span></span><span style=display:flex><span>dir /mnt/nvme/kvrocks
</span></span></code></pre></div><p>运行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./build/kvrocks -c kvrocks.conf
</span></span></code></pre></div><h4 id=运行ycsb进行测试>运行ycsb进行测试<a hidden class=anchor aria-hidden=true href=#运行ycsb进行测试>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./bin/ycsb.sh load redis -s -P workloads/workloada -threads <span style=color:#ae81ff>28</span> -p redis.host<span style=color:#f92672>=</span>127.0.0.1 -p redis.port<span style=color:#f92672>=</span><span style=color:#ae81ff>6666</span>
</span></span></code></pre></div><h4 id=报错>报错<a hidden class=anchor aria-hidden=true href=#报错>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>/usr/bin/java  -classpath /home/lzy/ycsb-0.17.0/conf:/home/lzy/ycsb-0.17.0/lib/HdrHistogram-2.1.4.jar:/home/lzy/ycsb-0.17.0/lib/core-0.17.0.jar:/home/lzy/ycsb-0.17.0/lib/htrace-core4-4.1.0-incubating.jar:/home/lzy/ycsb-0.17.0/lib/jackson-core-asl-1.9.4.jar:/home/lzy/ycsb-0.17.0/lib/jackson-mapper-asl-1.9.4.jar:/home/lzy/ycsb-0.17.0/redis-binding/lib/commons-pool2-2.4.2.jar:/home/lzy/ycsb-0.17.0/redis-binding/lib/jedis-2.9.0.jar:/home/lzy/ycsb-0.17.0/redis-binding/lib/redis-binding-0.17.0.jar site.ycsb.Client -load -db site.ycsb.db.RedisClient -s -P workloads/workloada -threads <span style=color:#ae81ff>28</span> -p redis.host<span style=color:#f92672>=</span>127.0.0.1 -p redis.port<span style=color:#f92672>=</span><span style=color:#ae81ff>6666</span>
</span></span><span style=display:flex><span>redis.clients.jedis.exceptions.JedisConnectionException: java.net.SocketTimeoutException: Read timed out
</span></span><span style=display:flex><span>	at redis.clients.util.RedisInputStream.ensureFill<span style=color:#f92672>(</span>RedisInputStream.java:202<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at redis.clients.util.RedisInputStream.readByte<span style=color:#f92672>(</span>RedisInputStream.java:40<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at redis.clients.jedis.Protocol.process<span style=color:#f92672>(</span>Protocol.java:151<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at redis.clients.jedis.Protocol.read<span style=color:#f92672>(</span>Protocol.java:215<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at redis.clients.jedis.Connection.readProtocolWithCheckingBroken<span style=color:#f92672>(</span>Connection.java:340<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at redis.clients.jedis.Connection.getIntegerReply<span style=color:#f92672>(</span>Connection.java:265<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at redis.clients.jedis.Jedis.zadd<span style=color:#f92672>(</span>Jedis.java:1385<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at site.ycsb.db.RedisClient.insert<span style=color:#f92672>(</span>RedisClient.java:141<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at site.ycsb.DBWrapper.insert<span style=color:#f92672>(</span>DBWrapper.java:221<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at site.ycsb.workloads.CoreWorkload.doInsert<span style=color:#f92672>(</span>CoreWorkload.java:601<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at site.ycsb.ClientThread.run<span style=color:#f92672>(</span>ClientThread.java:135<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at java.base/java.lang.Thread.run<span style=color:#f92672>(</span>Thread.java:829<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Caused by: java.net.SocketTimeoutException: Read timed out
</span></span><span style=display:flex><span>	at java.base/java.net.SocketInputStream.socketRead0<span style=color:#f92672>(</span>Native Method<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at java.base/java.net.SocketInputStream.socketRead<span style=color:#f92672>(</span>SocketInputStream.java:115<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at java.base/java.net.SocketInputStream.read<span style=color:#f92672>(</span>SocketInputStream.java:168<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at java.base/java.net.SocketInputStream.read<span style=color:#f92672>(</span>SocketInputStream.java:140<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at java.base/java.net.SocketInputStream.read<span style=color:#f92672>(</span>SocketInputStream.java:126<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	at redis.clients.util.RedisInputStream.ensureFill<span style=color:#f92672>(</span>RedisInputStream.java:196<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>	... <span style=color:#ae81ff>11</span> more
</span></span></code></pre></div><h4 id=问题分析>问题分析<a hidden class=anchor aria-hidden=true href=#问题分析>#</a></h4><blockquote><p>参考</p><p><a href=https://blog.csdn.net/sinat_25311845/article/details/88051215>(22条消息) jedis的Read timed out异常解决_逆光飞翔2018的博客-CSDN博客_jedis read timeout</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>redis.clients.jedis.exceptions.JedisConnectionException: java.net.SocketTimeoutException: Read timed out
</span></span></code></pre></div><p>表面客户端与服务端的socket连接超时，主要原因推测为数据量过大，导致服务端延时较长。</p><p>通过查看ycsb的redis客户端源码，默认的客户端延时为2秒，所以当超时后，客户端主动关闭了连接。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String TIMEOUT_PROPERTY <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;redis.timeout&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>jedis <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Jedis<span style=color:#f92672>(</span>host<span style=color:#f92672>,</span> port<span style=color:#f92672>,</span> Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>parseInt</span><span style=color:#f92672>(</span>redisTimeout<span style=color:#f92672>));</span>
</span></span></code></pre></div><p>需要修改jedis的timeout参数，通过在执行ycsb时，使用 <code>-p</code> 参数，指定 <code>redis.timeout</code> 修改成一个比较大的值即可</p><p>同时需要修改kvrocks.conf</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># line 26</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Close the connection after a client is idle for N seconds (0 to disable)</span>
</span></span><span style=display:flex><span>timeout <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The number of worker&#39;s threads, increase or decrease would affect the performance.</span>
</span></span><span style=display:flex><span>workers <span style=color:#ae81ff>28</span>
</span></span></code></pre></div><h4 id=完整正确的启动流程>完整正确的启动流程<a hidden class=anchor aria-hidden=true href=#完整正确的启动流程>#</a></h4><blockquote><p>使用 <code>numactl -N 0</code></p></blockquote><ol><li>启动kvrocks</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>numactl -N <span style=color:#ae81ff>0</span> ./build/kvrocks -c kvrocks.conf
</span></span></code></pre></div><ol start=2><li>启动ycsb的load</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>numactl -N <span style=color:#ae81ff>0</span> ./bin/ycsb.sh load redis -s -P workloads/workloada -threads <span style=color:#ae81ff>28</span> -p redis.host<span style=color:#f92672>=</span>127.0.0.1 -p redis.port<span style=color:#f92672>=</span><span style=color:#ae81ff>6666</span> -p redis.timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>100000</span>
</span></span></code></pre></div><ol start=3><li>执行ycsb的run</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>numactl -N <span style=color:#ae81ff>0</span> ./bin/ycsb.sh run redis -s -P workloads/workloada -threads <span style=color:#ae81ff>28</span> -p redis.host<span style=color:#f92672>=</span>127.0.0.1 -p redis.port<span style=color:#f92672>=</span><span style=color:#ae81ff>6666</span> -p redis.timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>100000</span>
</span></span></code></pre></div><ol start=4><li><p>收集完成执行结果</p></li><li><p>关闭kvrocks</p></li><li><p>删除其在硬盘中的数据</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rm -r /mnt/nvme/kvrocks/*
</span></span></code></pre></div><h3 id=测试指标>测试指标<a hidden class=anchor aria-hidden=true href=#测试指标>#</a></h3><p>在750机器上进行测试</p><p>ycsb使用28线程，kvrocks的worker也使用28，不限制硬盘空间，默认worker数为8+</p><p><img loading=lazy src=E:%5cStudy%5cblog%5ccontent%5cposts%5cYCSB%e6%b5%8b%e8%af%95%e6%96%87%e6%a1%a3%5cv2-4a9bb286d563121767f03c4c1a1f7cfa_720w-1675512715956.jpg alt="Kvrocks 设计与实现"></p><p>主要收集<strong>吞吐率</strong>，<strong>平均延时</strong>，<strong>95%延时</strong>和<strong>99%延时</strong>的数据</p><h2 id=redis>redis<a hidden class=anchor aria-hidden=true href=#redis>#</a></h2><h3 id=简介-2>简介<a hidden class=anchor aria-hidden=true href=#简介-2>#</a></h3><p>Redis（Remote Dictionary Server )，即远程字典服务，是一个开源的使用ANSI <a href="https://baike.baidu.com/item/C%E8%AF%AD%E8%A8%80?fromModule=lemma_inlink">C语言</a>编写、支持网络、可基于内存亦可持久化的日志型、Key-Value<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93/103728?fromModule=lemma_inlink">数据库</a>，并提供多种语言的API。</p><p><a href=https://github.com/redis/redis>https://github.com/redis/redis</a></p><h3 id=安装使用-2>安装使用<a hidden class=anchor aria-hidden=true href=#安装使用-2>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 下载源码</span>
</span></span><span style=display:flex><span>wget https://download.redis.io/redis-stable.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 编译</span>
</span></span><span style=display:flex><span>tar -xzvf redis-stable.tar.gz
</span></span><span style=display:flex><span>cd redis-stable
</span></span><span style=display:flex><span>make
</span></span></code></pre></div><h4 id=运行-2>运行<a hidden class=anchor aria-hidden=true href=#运行-2>#</a></h4><p>编译后的可执行文件位于 <code>./src</code> 中</p><p>服务端为 <code>redis-server</code> ，客户端为 <code>redis-cli</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./src/redis-server &amp;
</span></span><span style=display:flex><span>./src/redis-cli
</span></span><span style=display:flex><span>127.0.0.1&gt;PING
</span></span><span style=display:flex><span>PONG
</span></span></code></pre></div><h4 id=配置>配置<a hidden class=anchor aria-hidden=true href=#配置>#</a></h4><p>配置文件位于软件根目录下的 <code>redis.conf</code> 中</p><p>如果需要使用配置文件，使用如下命令启动</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./src/redis-server redis.conf
</span></span></code></pre></div><h3 id=使用ycsb进行测试-1>使用YCSB进行测试<a hidden class=anchor aria-hidden=true href=#使用ycsb进行测试-1>#</a></h3><h4 id=ycsb编译-1>ycsb编译<a hidden class=anchor aria-hidden=true href=#ycsb编译-1>#</a></h4><p>编译与对kvrocks进行测试的方式相同</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mvn -pl site.ycsb:redis-binding -am clean package
</span></span></code></pre></div><h4 id=运行redis>运行redis<a hidden class=anchor aria-hidden=true href=#运行redis>#</a></h4><p>选择是否启动持久化，以及持久化的存放目录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Save the DB to disk.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># save &lt;seconds&gt; &lt;changes&gt; [&lt;seconds&gt; &lt;changes&gt; ...]</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Redis will save the DB if the given number of seconds elapsed and it</span>
</span></span><span style=display:flex><span><span style=color:#75715e># surpassed the given number of write operations against the DB.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Snapshotting can be completely disabled with a single empty string argument</span>
</span></span><span style=display:flex><span><span style=color:#75715e># as in following example:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># save &#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Unless specified otherwise, by default Redis will save the DB:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   * After 3600 seconds (an hour) if at least 1 change was performed</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   * After 300 seconds (5 minutes) if at least 100 changes were performed</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   * After 60 seconds if at least 10000 changes were performed</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># You can set these explicitly by uncommenting the following line.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># save 3600 1 300 100 60 10000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The working directory.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># The DB will be written inside this directory, with the filename specified</span>
</span></span><span style=display:flex><span><span style=color:#75715e># above using the &#39;dbfilename&#39; configuration directive.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># The Append Only File will also be created inside this directory.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Note that you must specify a directory here, not a file name.</span>
</span></span><span style=display:flex><span>dir /mnt/nvme/redis
</span></span></code></pre></div><p>使用指定配置启动redis</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./src/redis-server redis.conf
</span></span></code></pre></div><h4 id=运行ycsb进行测试-1>运行ycsb进行测试<a hidden class=anchor aria-hidden=true href=#运行ycsb进行测试-1>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./bin/ycsb.sh load redis -s -P workloads/workloada -threads <span style=color:#ae81ff>28</span> -p redis.host<span style=color:#f92672>=</span>127.0.0.1 -p redis.port<span style=color:#f92672>=</span><span style=color:#ae81ff>6379</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./bin/ycsb.sh run redis -s -P workloads/workloada -threads <span style=color:#ae81ff>28</span> -p redis.host<span style=color:#f92672>=</span>127.0.0.1 -p redis.port<span style=color:#f92672>=</span><span style=color:#ae81ff>6379</span>
</span></span></code></pre></div><h3 id=测试指标-1>测试指标<a hidden class=anchor aria-hidden=true href=#测试指标-1>#</a></h3><p>测试开启持久化与关闭持久化下的性能</p><p>主要收集<strong>吞吐率</strong>，<strong>平均延时</strong>，<strong>95%延时</strong>和<strong>99%延时</strong>的数据</p><h2 id=rocksdb>RocksDB<a hidden class=anchor aria-hidden=true href=#rocksdb>#</a></h2><h3 id=简介-3>简介<a hidden class=anchor aria-hidden=true href=#简介-3>#</a></h3><p>RocksDB是FaceBook起初作为实验性质开发的，旨在充分实现快存上存储数据的服务能力。由Facebook的Dhruba Borthakur于2012年4月创建的LevelDB的分支，最初的目标是提高服务工作负载的性能，最大限度的发挥<strong>闪存和RAM</strong>的高度率读写性能。</p><p>Key和value是任意大小的字节流支持原子的读和写。除此外，RocksDB深度支持各种配置，可以在不同的生产环境（纯内存、Flash、hard disks or HDFS）中调优，RocksDB针对多核CPU、高效快速存储（SSD)、I/O bound workload做了优化，支持不同的数据压缩算法、和生产环境debug的完善工具。</p><p><a href=https://github.com/facebook/rocksdb>https://github.com/facebook/rocksdb</a></p><h3 id=安装使用-3>安装使用<a hidden class=anchor aria-hidden=true href=#安装使用-3>#</a></h3><h4 id=依赖>依赖<a hidden class=anchor aria-hidden=true href=#依赖>#</a></h4><ul><li><a href=http://www.zlib.net/>zlib</a> - a library for data compression.</li><li><a href=http://www.bzip.org/>bzip2</a> - a library for data compression.</li><li><a href=https://github.com/lz4/lz4>lz4</a> - a library for extremely fast data compression.</li><li><a href=http://google.github.io/snappy/>snappy</a> - a library for fast data compression.</li><li><a href=http://www.zstd.net/>zstandard</a> - Fast real-time compression algorithm.</li></ul><p>gcc >= 7</p><h4 id=编译-2>编译<a hidden class=anchor aria-hidden=true href=#编译-2>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git clone https://github.com/facebook/rocksdb.git
</span></span><span style=display:flex><span>cd rocksdb
</span></span><span style=display:flex><span>make static_lib <span style=color:#75715e># will compile librocksdb.a, RocksDB static library. Compiles static library in release mode.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>make shared_lib <span style=color:#75715e># will compile librocksdb.so, RocksDB shared library. Compiles shared library in release mode.</span>
</span></span></code></pre></div><h4 id=运行-3>运行<a hidden class=anchor aria-hidden=true href=#运行-3>#</a></h4><p>rocksdb是一个嵌入式的数据库，与redis不同，是通过链接库连接到应用上，与应用一同运行。</p><h3 id=使用ycsb进行测试-2>使用YCSB进行测试<a hidden class=anchor aria-hidden=true href=#使用ycsb进行测试-2>#</a></h3><p>由于rocksdb嵌入式的特性，ycsb通过maven提供了rocksdb的下载，在rocksdb的目录中pom.xml文件可以看到</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;groupId&gt;</span>org.rocksdb<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;artifactId&gt;</span>rocksdbjni<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;version&gt;</span>${rocksdb.version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>这里会下载rocksdb在maven仓库中最新的版本，一般为6。可以下载下来直接进行测试，可直接跳到<strong>ycsb编译</strong>部分</p><h4 id=rocksdb-java版本>rocksdb java版本<a hidden class=anchor aria-hidden=true href=#rocksdb-java版本>#</a></h4><blockquote><p>参考</p><p><a href=https://blog.csdn.net/CoolBoySilverBullet/article/details/122162072>(22条消息) 【测试】自定义配置 RocksDB 进行 YCSB 测试_ywang_wnlo的博客-CSDN博客</a></p><p><a href=https://www.cnblogs.com/zhao-shan/p/16498061.html>Maven添加本地jar包 - 赵羴 - 博客园 (cnblogs.com)</a></p></blockquote><p>如果需要使用指定的版本，或者使用rocksdb的最新编译版本，首先需要用java对rocksdb进行编译</p><p>java >=8</p><p><strong>注意</strong>需要修改rocksdb的makefile</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-makefile data-lang=makefile><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>238：</span>ROCKSDB_DISABLE_MEMKIND<span style=color:#f92672>=</span>true
</span></span></code></pre></div><p>这里关闭rocksdb的MEMKIND，否则在运行ycsb时，会报如下错误</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>INFO site.ycsb.db.rocksdb.RocksDBClient - RocksDB data dir: /mnt/nvme/rocksdb
</span></span><span style=display:flex><span>2022-10-31 16:24:26:554 <span style=color:#ae81ff>0</span> sec: <span style=color:#ae81ff>0</span> operations; est completion in <span style=color:#ae81ff>0</span> second 
</span></span><span style=display:flex><span>Exception in thread <span style=color:#e6db74>&#34;Thread-23&#34;</span> java.lang.UnsatisfiedLinkError: /tmp/librocksdbjni5496689695031159979.so: /tmp/librocksdbjni5496689695031159979.so: undefined symbol: MEMKIND_DAX_KMEM
</span></span></code></pre></div><p>然后编译java版本的rocksdb</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 安装依赖</span>
</span></span><span style=display:flex><span>sudo apt-get install libgflags-dev libsnappy-dev zlib1g-dev libbz2-dev liblz4-dev libzstd-dev
</span></span><span style=display:flex><span><span style=color:#75715e># 配置环境变量</span>
</span></span><span style=display:flex><span>export JAVA_HOME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/usr/lib/jvm/java-11-openjdk-amd64&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 编译release版本</span>
</span></span><span style=display:flex><span>make -j<span style=color:#66d9ef>$(</span>nproc<span style=color:#66d9ef>)</span> rocksdbjavastatic
</span></span></code></pre></div><p>编译好的文件位于 <code>rocksdb/java/target/rocksdbjni-7.8.0-linux64.jar</code></p><p>然后将此jar文件加入到本地的maven仓库中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mvn install:install-file
</span></span><span style=display:flex><span>  -Dfile<span style=color:#f92672>=</span>&lt;path-to-file&gt;
</span></span><span style=display:flex><span>  -DgroupId<span style=color:#f92672>=</span>&lt;group-id&gt;
</span></span><span style=display:flex><span>  -DartifactId<span style=color:#f92672>=</span>&lt;artifact-id&gt;
</span></span><span style=display:flex><span>  -Dversion<span style=color:#f92672>=</span>&lt;version&gt;
</span></span><span style=display:flex><span>  -Dpackaging<span style=color:#f92672>=</span>&lt;packaging&gt;
</span></span><span style=display:flex><span>  -DgeneratePom<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Where: &lt;path-to-file&gt;  the path to the file to load
</span></span><span style=display:flex><span>       &lt;group-id&gt;      the group that the file should be registered under
</span></span><span style=display:flex><span>       &lt;artifact-id&gt;   the artifact name <span style=color:#66d9ef>for</span> the file
</span></span><span style=display:flex><span>       &lt;version&gt;       the version of the file
</span></span><span style=display:flex><span>       &lt;packaging&gt;     the packaging of the file e.g. jar
</span></span></code></pre></div><p>修改ycsb中rocksdb的pom.xml中对应指定的版本等信息</p><h4 id=ycsb编译-2>ycsb编译<a hidden class=anchor aria-hidden=true href=#ycsb编译-2>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mvn -pl site.ycsb:rocksdb-binding -am clean package
</span></span></code></pre></div><h4 id=运行ycsb进行测试-2>运行ycsb进行测试<a hidden class=anchor aria-hidden=true href=#运行ycsb进行测试-2>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 装载数据</span>
</span></span><span style=display:flex><span>./bin/ycsb.sh load rocksdb -s -P workloads/workloada -threads <span style=color:#ae81ff>28</span> -p rocksdb.dir<span style=color:#f92672>=</span>/mnt/nvme/rocksdb
</span></span><span style=display:flex><span><span style=color:#75715e># 运行</span>
</span></span><span style=display:flex><span>./bin/ycsb.sh run rocksdb -s -P workloads/workloada -threads <span style=color:#ae81ff>28</span> -p rocksdb.dir<span style=color:#f92672>=</span>/mnt/nvme/rocksdb
</span></span></code></pre></div><h4 id=配置-1>配置<a hidden class=anchor aria-hidden=true href=#配置-1>#</a></h4><p><code>rocksdb.dir</code> 指定了rocksdb运行时数据存放在硬盘上的位置</p><p><code>rocksdb.optionsfile</code> 指定了运行时rocksdb的配置，可选，如果为空，使用ycsb提供的默认配置</p><h3 id=测试指标-2>测试指标<a hidden class=anchor aria-hidden=true href=#测试指标-2>#</a></h3><p>主要收集<strong>吞吐率</strong>，<strong>平均延时</strong>，<strong>95%延时</strong>和<strong>99%延时</strong>的数据</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://flyingsnow31.github.io/tags/ycsb/>YCSB</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://flyingsnow31.github.io/>Flying Snow Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>